<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Mergington High — Activities</title>
	<link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
	<header class="site-header">
		<h1>Mergington High — Extracurricular Activities</h1>
		<p class="lead">Browse activities and see who's already signed up.</p>
	</header>

	<main id="content" class="container">
		<div id="grid" class="grid"></div>
	</main>

	<footer class="site-footer">
		<small>Built with ❤️ by Mergington High</small>
	</footer>

	<script>
		async function loadActivities() {
			const res = await fetch('/activities');
			if (!res.ok) {
				document.getElementById('content').innerText = 'Failed to load activities.';
				return;
			}
			const activities = await res.json();
			const grid = document.getElementById('grid');
			grid.innerHTML = '';

			Object.entries(activities).forEach(([name, info]) => {
				const card = document.createElement('article');
				card.className = 'card';

				card.innerHTML = `
					<h2 class="card-title">${escapeHtml(name)}</h2>
					<p class="muted">${escapeHtml(info.description || '')}</p>
					<div class="meta">
						<span><strong>Schedule:</strong> ${escapeHtml(info.schedule || 'TBA')}</span>
						<span><strong>Max:</strong> ${escapeHtml(String(info.max_participants || '—'))}</span>
					</div>
					<section class="participants">
						<h3>Participants</h3>
						${renderParticipants(info.participants)}
					</section>
				`;
				grid.appendChild(card);
			});
		}

		function renderParticipants(list) {
			if (!Array.isArray(list) || list.length === 0) {
				return '<p class="no-participants">No participants yet.</p>';
			}
			const items = list.map(email => `<li>${escapeHtml(email)}</li>`).join('');
			return `<ul class="participant-list">${items}</ul>`;
		}

		// Minimal escaping to avoid injecting HTML from the API
		function escapeHtml(str) {
			return String(str)
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#39;');
		}

		// Load on start
		window.addEventListener('DOMContentLoaded', loadActivities);
	</script>
</body>
</html>
